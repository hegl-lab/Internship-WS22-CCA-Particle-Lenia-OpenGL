cmake_minimum_required(VERSION 3.22)
project(particle_lenia)

set(CMAKE_CXX_STANDARD 14)
set(CMAKE_CXX_STANDARD_REQUIRED on)

add_library(glad src/glad.c)

include_directories(${PROJECT_SOURCE_DIR}/include ${PROJECT_SOURCE_DIR}/src/glfw-abstraction)

# abstractions used to interact with opengl
file(GLOB glfw-abstraction_SRC "src/glfw-abstraction/*.cpp")
add_library(glfw-abstraction ${glfw-abstraction_SRC})

# link libraries that all targets share to all targets
link_libraries(glfw ${GL_LIBRARY} m glad glfw-abstraction)

# imgui library, details can be found here https://github.com/ocornut/imgui/
add_library(imgui include/imgui/imgui.cpp include/imgui/imgui_draw.cpp include/imgui/imgui_tables.cpp
        include/imgui/imgui_widgets.cpp include/imgui/imgui_impl_glfw.cpp include/imgui/imgui_impl_opengl3.cpp)

add_executable(gui2d src/particle-lenia/gui2d.cpp)
target_link_libraries(gui2d imgui)

# Return the date (yyyy-mm-dd)
macro(DATE RESULT)
    if(WIN32)
        execute_process(COMMAND "cmd" " /C date /T" OUTPUT_VARIABLE ${RESULT})
        string(REGEX REPLACE "(..)/(..)/(....).*" "\\3-\\2-\\1" ${RESULT} ${${RESULT}})
    elseif(UNIX)
        execute_process(COMMAND "date" "+%Y-%m-%d" OUTPUT_VARIABLE ${RESULT})
    else()
        message(SEND_ERROR "Unable to detect date")
        set(${RESULT} UNKNOWN)
    endif()
endmacro()

file(GLOB fields_functions_2d ${CMAKE_SOURCE_DIR}/shaders/particle-lenia/fields_functions_2d.glsl)
set(generated_warning // This file is generated, do NOT edit this file!)


# copy shader files to binary folder
add_custom_target(copy-shaders ALL
        DEPENDS ${MY_TARGET}
        COMMAND ${CMAKE_COMMAND} -E copy_directory ${CMAKE_SOURCE_DIR}/shaders ${CMAKE_BINARY_DIR}/shaders
        COMMAND ${CMAKE_COMMAND} -E echo \"${generated_warning}\" > ${CMAKE_BINARY_DIR}/shaders/particle-lenia/fields_2d.generated.frag
        COMMAND ${CMAKE_COMMAND} -E cat ${fields_functions_2d} ${CMAKE_SOURCE_DIR}/shaders/particle-lenia/fields_2d.frag >> ${CMAKE_BINARY_DIR}/shaders/particle-lenia/fields_2d.generated.frag
        COMMAND ${CMAKE_COMMAND} -E echo \"${generated_warning}\" > ${CMAKE_BINARY_DIR}/shaders/particle-lenia/particle_2d.generated.vert
        COMMAND ${CMAKE_COMMAND} -E cat ${fields_functions_2d} ${CMAKE_SOURCE_DIR}/shaders/particle-lenia/particle_2d.vert >> ${CMAKE_BINARY_DIR}/shaders/particle-lenia/particle_2d.generated.vert
        )

